version: '3.5'

services:

  certificates:
    image: andyceo/monitoring-certificate
    command: --daemon
    environment:
      INFLUXDB_HOST: 'influxdb'
      INFLUXDB_PORT: 8086
      INFLUXDB_USER: telegraf
      INFLUXDB_PASSWORD_FILE: /run/secrets/telegraf-at-influxdb
      INFLUXDB_DATABASE: telegraf
    secrets:
      - telegraf-at-influxdb
    networks:
      - databases_influxdb
    volumes:
      - certbot-etc:/etc/letsencrypt:ro
    deploy:
      placement:
        constraints:
          - node.hostname == swarm01

  node-info-monitor-78-46-93-239:
    image: ergoplatform/node-info-monitor
    environment:
      MONITORING_NODE_URL: "http://78.46.93.239:9051"
    secrets:
      - testnet-at-influxdb
    networks:
      - databases_influxdb
    deploy:
      # temporarily disabled
      replicas: 0

networks:
  databases_influxdb:
    external: true

secrets:
  telegraf-at-influxdb:
    external: true
  testnet-at-influxdb:
    external: true

volumes:
  certbot-etc:
    external: true
    name: infrastructure_certbot-etc
